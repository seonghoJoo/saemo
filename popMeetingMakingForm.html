<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/all.min.css" />
    <link rel="stylesheet" href="css/notosanskr.css" />
    <link rel="stylesheet" href="css/popMeetingMakingForm.css" />
    <link rel="stylesheet" href="css/tui-date-picker.min.css" />
    <link rel="stylesheet" href="css/tui-time-picker.min.css" />
</head>
<style>


</style>
<body>
    <div id="meetingMakingWrap" class="step1"><!--meetingMakingWrap-->
        <div id="meetingMakingHeader"><!--meetingMakingHeader-->
            <div id="containerTitleBox"><!--containerTitleBox-->
                <span>밋팅 만들기</span>
            </div><!--//containerTitleBox-->
            <div id="meetingMakingProgressBox"><!--meetingMakingProgressBox-->
                <ol class="progress_list"><!--progress_list-->
                    <li class="progress_item"><p>1</p></li><!--
                    --><li class="progress_item"><p>2</p></li>
                    <li class="progress_item"><p>3</p></li><!--
                    --><li class="progress_item"><p>4</p></li>
                    <li class="progress_item"><p>5</p></li>
                </ol><!--//progress_list-->
            </div><!--//meetingMakingProgressBox-->
        </div><!--//meetingMakingHeader-->
        <div id="meetingMakingContents"><!--meetingMakingContents-->
            <div class="essential_step"><!--essentialStep-->
                <div class="meeting_part_box"><!--meeting_part_box-->
                    <label>파트</label>
                    <select id="partDropdown"><!--partDropdown-->
                        <option>대결</option>
                        <option>친목</option>
                    </select><!--//partDropdown-->
                </div><!--//meeting_part_box-->
                <div class="meeting_name_box"><!--meeting_name_box-->
                    <label>이름</label>
                    <input id="meetingNameInput" maxlength="10" /><!--<i class="fas fa-exclamation-circle"></i>-->
                    <span class="text_length_notice">최소 2자 / 최대 10자</span>
                    <span class="text_length"></span>
                </div><!--//meeting_name_box-->
                <div class="calender_box"><!--calender_box-->
                    <label>날짜</label>
                    <div class="tui-datepicker-input tui-datetime-input tui-has-focus ">
                        <input type="text" id="datepicker-input" aria-label="Date-Time">
                        <span class="tui-ico-date"></span>
                    </div>
                    <div id="datePickerWrapper"></div>
                </div><!--//calender_box-->
                <div class="time_box"><!--time_box-->
                    <label>시간</label>
                    <div id="timePickerWrapper"></div>
                    <span>~</span>
                    <div id="timePickerWrapper2"></div>
                    <div class="all_day_btn_box"><input id="allDayBtn" type="checkbox" /><label for="allDayBtn">하루종일</label></div>
                </div><!--//time_box-->
                <div class="theme_box"><!--theme_box-->
                    <label>테마</label>
                    <select id="themeDropdown"><!--partDropdown-->
                        <option>너희와 있어 즐겁다</option>
                        <option>이쁜 달밤 아래에서</option>
                        <option>나가자!싸우자!</option>
                        <option>함께라서 더 즐겁다</option>
                        <option>움직이기 싫어~</option>
                        <option>주저리주저리</option>
                        <option>요즘 그게 유행이래</option>
                        <option>건강부터 챙기자</option>
                        <option>1.2kg 1.2kg</option>
                        <option>내일은 없다</option>
                    </select><!--//partDropdown-->
                </div><!--//theme_box-->
            </div><!--//essentialStep-->
            <div class="location_step"><!--locationStep-->
                <div class="meeting_address_box"><!--meeting_address_box-->
                    <label>주소</label>
                    <input type="text" id="sample5_address" placeholder="주소검색">
                    <input id="specifyAddressInput" placeholder="상세주소 입력"/>
                    <input type="button" onclick="sample5_execDaumPostcode()">
                    <div id="map"></div>
                </div><!--//meeting_address_box-->
            </div><!--//locationStep-->
            <div class="additional_step"><!--additionalStep-->
                <div class="meeting_category_box"><!--meeting_category_box-->
                    <label>분류</label>
                    <input id="meetingCategoryB" />
                </div><!--//meeting_category_box-->
                <div class="meeting_image_box"><!--meeting_image_box-->
                    <i class="far fa-image"></i>
                    <div class="meeting_image"><button type=""><i class="far fa-plus-square"></i></button></div>
                </div><!--//meeting_image_box-->
                <div class="meeting_point_box"><!--meeting_category_box-->
                    <label>포인트</label>
                    <input id="meetingPointInput" />
                    <div class="having_point">
                        <img src="img/saemoPoint.png" width="15px" height="15px" />
                        <span data-point="3500"></span>
                    </div>
                </div><!--//meeting_category_box-->
                <div class="meeting_explanation_box"><!--meeting_category_box-->
                    <label>세부설명</label>
                    <input id="meetingExplanationInput" maxlength="20" />
                    <span class="explanation_length">(0 / 20자)</span>
                </div><!--//meeting_category_box-->
            </div><!--//additionalStep-->
            <div class="rule_step"><!--ruleStep-->
                <div class="meeting_rule_box"><!--meeting_rule_box-->
                    <label>규칙</label>
                    <input id="meetingRuleInput" maxlength="40" />
                    <button>추가</button>
                    <span class="rule_number">(0 / 4개)</span>
                    <span class="rule_length">(0 / 40자)</span>
                    <div class="rules_box"><!--rules_box-->
                        <ul class="rule_list"><!--rule_list-->
                        </ul><!--//rule_list-->
                    </div><!--//rules_box-->
                </div><!--//meeting_rule_box-->
                <div class="meeting_material_box"><!--meeting_material_box-->
                    <label>준비물</label>
                    <input id="meetingMaterialInput" maxlength="20" />
                    <button>추가</button>
                    <span class="material_length">(0 / 20자)</span>
                    <div class="materials_box"><!--materials_box-->
                        <ul class="material_list"><!--material_list-->
                        </ul><!--//material_list-->
                    </div><!--//materials_box-->
                </div><!--//meeting_material_box-->
            </div><!--//ruleStep-->
            <div class="confirm_step"><!--confirmStep-->
            </div><!--//confirmStep-->
        </div><!--//meetingMakingContents-->
        <i id="nextBtn" class="fas fa-angle-right"></i>
        <i id="prevBtn" class="fas fa-angle-left"></i>
    </div><!--//meetingMakingWrap-->

<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=70794a76a110afe1608244fb91d2b83d&libraries=services"></script>
<script src="js/tui-date-picker.min.js"></script>
<script src="js/tui-time-picker.min.js"></script>
<script src="js/jquery.js"></script>
<script>
    // 조건 충족해야 다음 스텝으로 넘어갈 수 있도록 하는 기능
    //-------------------------------------------------
    // 화면 넘기기 기능
    let currentIdx = 1;
    $("#nextBtn").click(function () {
        // if($meetingNameInput.val().length<2){
        //
        // }else{
            $("#meetingMakingWrap").attr("class","step"+ ++currentIdx);
            if(currentIdx==2){map.relayout();}
        // }
    });
    $("#prevBtn").click(function () {
        $("#meetingMakingWrap").attr("class","step"+ --currentIdx);
        if(currentIdx==2){map.relayout();}
    });

    const $progressList = $(".progress_list");
    $("#nextBtn").click(function(){
        $progressList.children("li").eq(currentIdx-2).css("border-left", "45px solid #E0E0E0");
        $progressList.children("li").eq(currentIdx-1).css("border-left", "45px solid #FFAB40");
    });
    $("#prevBtn").click(function(){
    $progressList.children("li").eq(currentIdx).css("border-left", "45px solid #E0E0E0");
    $progressList.children("li").eq(currentIdx-1).css("border-left", "45px solid #FFAB40");
    });
    //-------------------------------------------------

    // datePicker
    let today = new Date();
    const datepicker = new tui.DatePicker("#datePickerWrapper", {
        language: 'ko',
        date: new Date(),
        input: {
            element: '#datepicker-input',
            format: 'yyyy년 MM월 dd일'
        },
        autoClose: true
    })
    //-------------------------------------------------

    // timePicker
    const $timepicker = new tui.TimePicker("#timePickerWrapper", {
        language: "ko",
        initialHour: 0,
        initialMinute: 0,
        hourStep: 1,
        minuteStep: 10,
        showMeridiem: false,
        inputType: "spinbox"
    })
    const $timepicker2 = new tui.TimePicker("#timePickerWrapper2", {
        language: "ko",
        initialHour: 0,
        initialMinute: 0,
        hourStep: 1,
        minuteStep: 10,
        showMeridiem: false,
        inputType: "spinbox"
    })
    //-------------------------------------------------

    // 하루종일 체크 시 시간 블락 먹이는 기능
    const $timeInput = $(".tui-timepicker-spinbox-input");
    const $timeBtn = $(".tui-timepicker-btn");
    const $timeBtnIcon = $(".tui-timepicker-btn>span");

    $("#allDayBtn").change(function() {
        if($(this).prop("checked")) {
            $timeInput.attr("disabled", true);
            $timeBtn.attr("disabled", true);
            $timeBtnIcon.css("pointer-events","none");
            $timepicker.setTime(0,0);
            $timepicker2.setTime(23,50);
        }else{
            $timeInput.removeAttr("disabled");
            $timeBtn.removeAttr("disabled");
            $timeBtnIcon.css("pointer-events","");
            $timepicker2.setTime(0,0);
        }
    });
    //-------------------------------------------------

    // 글자 길이를 알려주고 일정 이상 넘어가는 걸 막는 함수
    function textLengthGetPrevent($input, $lengthElement){
        let currentLength = $input.val().length;
        $lengthElement.text("("+currentLength+" / "+$input.attr("maxlength")+"자)");
    }
    //-------------------------------------------------

    // 밋팅이름 길이 세주고 보였다 말았다 하는 기능
    $meetingNameInput = $("#meetingNameInput");
    $textLengthNotice = $(".text_length_notice");
    $textLength = $(".text_length");
    $meetingNameInput.keyup(function(){
        if($(this).val().length==0){
            $textLengthNotice.css("display", "");
            $textLength.empty();
        }else{
            $textLengthNotice.css("display", "none");
            textLengthGetPrevent($(this), $textLength);
        }
    })
    //-------------------------------------------------

    // 카카오 주소API
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
            center: new daum.maps.LatLng(37.480116, 126.953891), // 지도의 중심좌표
            level: 5 // 지도의 확대 레벨
        };

    //지도를 미리 생성
    var map = new daum.maps.Map(mapContainer, mapOption);
    //주소-좌표 변환 객체를 생성
    var geocoder = new daum.maps.services.Geocoder();
    //마커를 미리 생성
    var marker = new daum.maps.Marker({
        position: new daum.maps.LatLng(100, 127.005476),
        map: map
    });

    function sample5_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                var addr = data.address; // 최종 주소 변수

                // 주소 정보를 해당 필드에 넣는다.
                document.getElementById("sample5_address").value = addr;
                // 주소로 상세 정보를 검색
                geocoder.addressSearch(data.address, function(results, status) {
                    // 정상적으로 검색이 완료됐으면
                    if (status === daum.maps.services.Status.OK) {

                        var result = results[0]; //첫번째 결과의 값을 활용

                        // 해당 주소에 대한 좌표를 받아서
                        var coords = new daum.maps.LatLng(result.y, result.x);
                        // 지도를 보여준다.
                        mapContainer.style.display = "block";
                        map.relayout();
                        // 지도 중심을 변경한다.
                        map.setCenter(coords);
                        // 마커를 결과값으로 받은 위치로 옮긴다.
                        marker.setPosition(coords)
                    }
                });
            }
        }).open();
    }
    //---------------------------------------------------------------

    // point표시 기능
    const $havingPoint = $(".having_point>span");
    let point = $havingPoint.data("point");
    $havingPoint.text(point);
    // ----------------------------------------------------

    // 세부설명 길이 세주는 기능
    $meetingExplanationInput = $("#meetingExplanationInput");
    $explanationLenth = $(".explanation_length");
    $meetingExplanationInput.keyup(function(){
        textLengthGetPrevent($(this), $explanationLenth);
    })
    //-------------------------------------------------

    // 룰 추가 버튼
    const $ruleBtn = $("#ruleForm>button");
    $ruleBtn.click(function(e){
        e.preventDefault();
    });
    //----------------------------------------------

    // 규칙&준비물 길이 세주는 기능
    const $meetingRuleInput = $("#meetingRuleInput");
    const $ruleLength = $(".rule_length");
    $meetingRuleInput.keyup(function(){
        textLengthGetPrevent($(this), $ruleLength);
    });

    $meetingMaterialInput = $("#meetingMaterialInput");
    $materialLength = $(".material_length");
    $meetingMaterialInput.keyup(function(){
        textLengthGetPrevent($(this), $materialLength)
    });
    //-------------------------------------------------

    // 규칙&준비물 추가 기능
    $meetingRuleInput.keyup(function(e){
        if(e.keyCode==13){
            if($(".rule_list").children("li").length==4){
                alert("규칙은 최대 4개까지 가능합니다.")
            }else{
                ruleAdd($(this).val());
                $(this).val("");
                textLengthGetPrevent($(this), $ruleLength);
            }
        }
    });
    $meetingMaterialInput.keyup(function(e){
        if(e.keyCode==13){
            materialAdd($(this).val());
            $(this).val("");
            textLengthGetPrevent($(this), $materialLength);
        }
    });

    const $ruleAddBtn = $("#meetingRuleInput+button");
    const $materilaAddBtn = $("#meetingMaterialInput+button");
    $ruleAddBtn.click(function(){
        if($(".rule_list").children("li").length==4){
            alert("규칙은 최대 4개까지 가능합니다.")
        }else {
            ruleAdd($meetingRuleInput.val());
            $meetingRuleInput.val("");
            textLengthGetPrevent($meetingRuleInput, $ruleLength);
        }
    });
    $materilaAddBtn.click(function(){
        materialAdd($meetingMaterialInput.val());
        $meetingMaterialInput.val("");
        textLengthGetPrevent($meetingMaterialInput, $materialLength);
    })

    function ruleAdd(ruleText){
        let rule = $("<li><span></span><button>X</button></li>");
        rule.eq(0).attr("class","rule_item");
        rule.children("span").text(ruleText);
        rule.eq(0).children().eq(1).bind("mousedown", function(){
            $(this).parent().remove();
            $(".rule_number").text("("+$(".rule_list").children("li").length+" / 4개)");
        });

        $(".rule_list").append(rule);
        $(".rule_number").text("("+$(".rule_list").children("li").length+" / 4개)");

    }
    function materialAdd(materialText){
        let material = $("<li><span></span><button>X</button></li>");
        material.eq(0).attr("class","material_item");
        material.children("span").text(materialText);
        material.eq(0).children().eq(1).bind("mousedown", function(){
            $(this).parent().remove();
        });

        $(".material_list").append(material);
    }
    //-------------------------------------------------


</script>
</body>
</html>